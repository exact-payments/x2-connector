!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("x2-connector",t):e["x2-connector"]=t()}(this,function(){"use strict";function e(){}function t(){t.init.call(this)}function n(e){return void 0===e._maxListeners?t.defaultMaxListeners:e._maxListeners}function r(e,t,n){if(t)e.call(n);else for(var r=e.length,o=d(e,r),i=0;i<r;++i)o[i].call(n)}function o(e,t,n,r){if(t)e.call(n,r);else for(var o=e.length,i=d(e,o),s=0;s<o;++s)i[s].call(n,r)}function i(e,t,n,r,o){if(t)e.call(n,r,o);else for(var i=e.length,s=d(e,i),u=0;u<i;++u)s[u].call(n,r,o)}function s(e,t,n,r,o,i){if(t)e.call(n,r,o,i);else for(var s=e.length,u=d(e,s),a=0;a<s;++a)u[a].call(n,r,o,i)}function u(e,t,n,r){if(t)e.apply(n,r);else for(var o=e.length,i=d(e,o),s=0;s<o;++s)i[s].apply(n,r)}function a(t,r,o,i){var s,u,a;if("function"!=typeof o)throw new TypeError('"listener" argument must be a function');if(u=t._events,u?(u.newListener&&(t.emit("newListener",r,o.listener?o.listener:o),u=t._events),a=u[r]):(u=t._events=new e,t._eventsCount=0),a){if("function"==typeof a?a=u[r]=i?[o,a]:[a,o]:i?a.unshift(o):a.push(o),!a.warned&&(s=n(t),s&&s>0&&a.length>s)){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+r+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=r,c.count=a.length,f(c)}}else a=u[r]=o,++t._eventsCount;return t}function f(e){"function"==typeof console.warn?console.warn(e):console.log(e)}function c(e,t,n){function r(){e.removeListener(t,r),o||(o=!0,n.apply(e,arguments))}var o=!1;return r.listener=n,r}function l(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function h(e,t){for(var n=t,r=n+1,o=e.length;r<o;n+=1,r+=1)e[n]=e[r];e.pop()}function d(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function p(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function y(e){return e&&e.__esModule?e.default:e}function v(e,t){return t={exports:{}},e(t,t.exports),t.exports}var m;e.prototype=Object.create(null),t.usingDomains=!1,t.prototype.domain=void 0,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.init=function(){this.domain=null,t.usingDomains&&(!m.active||this instanceof m.Domain||(this.domain=m.active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},t.prototype.getMaxListeners=function(){return n(this)},t.prototype.emit=function(e){var t,n,a,f,c,l,h,d=!1,p="error"===e;if(l=this._events)p=p&&null==l.error;else if(!p)return!1;if(h=this.domain,p){if(t=arguments[1],!h){if(t instanceof Error)throw t;var y=new Error('Uncaught, unspecified "error" event. ('+t+")");throw y.context=t,y}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=h,t.domainThrown=!1,h.emit("error",t),!1}if(n=l[e],!n)return!1;var v="function"==typeof n;switch(a=arguments.length){case 1:r(n,v,this);break;case 2:o(n,v,this,arguments[1]);break;case 3:i(n,v,this,arguments[1],arguments[2]);break;case 4:s(n,v,this,arguments[1],arguments[2],arguments[3]);break;default:for(f=new Array(a-1),c=1;c<a;c++)f[c-1]=arguments[c];u(n,v,this,f)}return d&&h.exit(),!0},t.prototype.addListener=function(e,t){return a(this,e,t,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(e,t){return a(this,e,t,!0)},t.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,c(this,e,t)),this},t.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,c(this,e,t)),this},t.prototype.removeListener=function(t,n){var r,o,i,s,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(o=this._events,!o)return this;if(r=o[t],!r)return this;if(r===n||r.listener&&r.listener===n)0===--this._eventsCount?this._events=new e:(delete o[t],o.removeListener&&this.emit("removeListener",t,r.listener||n));else if("function"!=typeof r){for(i=-1,s=r.length;s-- >0;)if(r[s]===n||r[s].listener&&r[s].listener===n){u=r[s].listener,i=s;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0===--this._eventsCount)return this._events=new e,this;delete o[t]}else h(r,i);o.removeListener&&this.emit("removeListener",t,u||n)}return this},t.prototype.removeAllListeners=function(t){var n,r;if(r=this._events,!r)return this;if(!r.removeListener)return 0===arguments.length?(this._events=new e,this._eventsCount=0):r[t]&&(0===--this._eventsCount?this._events=new e:delete r[t]),this;if(0===arguments.length){for(var o,i=Object.keys(r),s=0;s<i.length;++s)o=i[s],"removeListener"!==o&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new e,this._eventsCount=0,this}if(n=r[t],"function"==typeof n)this.removeListener(t,n);else if(n)do this.removeListener(t,n[n.length-1]);while(n[0]);return this},t.prototype.listeners=function(e){var t,n,r=this._events;return r?(t=r[e],n=t?"function"==typeof t?[t.listener||t]:p(t):[]):n=[],n},t.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):l.call(e,t)},t.prototype.listenerCount=l,t.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var _="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),k=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(r)},x=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},T=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},E=v(function(e,t){!function(t,n){e.exports=n()}(_,function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.keys(t);return 0===n.length?e:e+encodeURI(n.reduce(function(e,n){return e+"&"+n+"="+(t[n]||"")},"?").replace("?&","?"))}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e.includes("?"))return{};var t={},r=decodeURI(e).split("?"),o=y(r,2),i=o[1],s=i.split("&");return s.forEach(function(e){var r=e.split("="),o=y(r,2),i=o[0],s=o[1];t[i]=n(s)}),t}function n(e){if(""!==e){if("true"===e)return!0;if("false"===e)return!1;var t=parseFloat(e);return Number.isNaN(t)||t!=e?e:t}}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.recursive.apply(k,[!0].concat(t))}function i(e,t){var n={};return Object.keys(e).forEach(function(r){t.indexOf(r)===-1&&(n[r]=e[r])}),n}function s(e,t){return e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}function u(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}function a(e,t){return!e||u(t)?t:s(e,t)}function f(e,t){return e[t]().then(function(t){return{headers:e.headers,status:e.status,statusText:e.statusText,data:t}})}function c(e,t){if(!e.ok){var n=new Error(e.statusText);return n.status=e.status,n.statusText=e.statusText,n.headers=e.headers,Promise.reject(n)}if(t)return f(e,t);var r=e.headers.get("Content-Type");return r&&r.includes("application/json")?f(e,"json"):f(e,"text")}!function(e){function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return y.iterable&&(t[Symbol.iterator]=function(){return t}),t}function o(e){this.map={},e instanceof o?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function i(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function s(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function u(e){var t=new FileReader;return t.readAsArrayBuffer(e),s(t)}function a(e){var t=new FileReader;return t.readAsText(e),s(t)}function f(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(y.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(y.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(e){if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob?(this.blob=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(u)},this.text=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return a(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=i(this);return e?e:Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(e){var t=e.toUpperCase();return v.indexOf(t)>-1?t:e}function l(e,t){t=t||{};var n=t.body;if(l.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new o(e.headers)),this.method=e.method,this.mode=e.mode,n||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new o(t.headers)),this.method=c(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function h(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(o))}}),t}function d(e){var t=new o,n=(e.getAllResponseHeaders()||"").trim().split("\n");return n.forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),o=n.join(":").trim();t.append(r,o)}),t}function p(e,t){t||(t={}),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof o?t.headers:new o(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var y={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};o.prototype.append=function(e,r){e=t(e),r=n(r);var o=this.map[e];o||(o=[],this.map[e]=o),o.push(r)},o.prototype.delete=function(e){delete this.map[t(e)]},o.prototype.get=function(e){var n=this.map[t(e)];return n?n[0]:null},o.prototype.getAll=function(e){return this.map[t(e)]||[]},o.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},o.prototype.set=function(e,r){this.map[t(e)]=[n(r)]},o.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)},o.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),r(e)},o.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),r(e)},o.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),r(e)},y.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];l.prototype.clone=function(){return new l(this)},f.call(l.prototype),f.call(p.prototype),p.prototype.clone=function(){return new p(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},p.error=function(){var e=new p(null,{status:0,statusText:""});return e.type="error",e};var m=[301,302,303,307,308];p.redirect=function(e,t){if(m.indexOf(t)===-1)throw new RangeError("Invalid status code");return new p(null,{status:t,headers:{location:e}})},e.Headers=o,e.Request=l,e.Response=p,e.fetch=function(e,t){return new Promise(function(n,r){function o(){return"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0}var i;i=l.prototype.isPrototypeOf(e)&&!t?e:new l(e,t);var s=new XMLHttpRequest;s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:d(s),url:o()},t="response"in s?s.response:s.responseText;n(new p(t,e))},s.onerror=function(){r(new TypeError("Network request failed"))},s.ontimeout=function(){r(new TypeError("Network request failed"))},s.open(i.method,i.url,!0),"include"===i.credentials&&(s.withCredentials=!0),"responseType"in s&&y.blob&&(s.responseType="blob"),i.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send("undefined"==typeof i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:window);var l=e,h="function"==typeof Symbol&&"symbol"==b(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":b(e)},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=t,m=l,_=v,w={buildQuery:m,parseQuery:_},g=function(){function e(){d(this,e),this._before=[],this._success=[],this._error=[],this._after=[]}return p(e,[{key:"before",value:function(e){return this._before.push(e),this._before.length-1}},{key:"success",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return this._success.push(e),this._success.length-1}},{key:"error",value:function(e){return this._error.push(e),this._error.length-1}},{key:"after",value:function(e){return this._after.push(e),this._after.length-1}},{key:"resolveBefore",value:function(e){return this._before.reduce(function(e,t){return e=e.then(t)},Promise.resolve(e))}},{key:"resolveSuccess",value:function(e){return this._success.reduce(function(e,t){return e=e.then(t)},Promise.resolve(e))}},{key:"resolveError",value:function(e){return this._error.forEach(function(t){return t&&t.call&&t(e)}),Promise.reject(e)}},{key:"resolveAfter",value:function(e){return this._after.reduce(function(e,t){return e=e.then(t)},Promise.resolve(e))}}]),e}(),k=r(function(e){!function(t){function n(e,t){if("object"!==o(e))return t;for(var r in t)"object"===o(e[r])&&"object"===o(t[r])?e[r]=n(e[r],t[r]):e[r]=t[r];return e}function r(e,t,r){var s=r[0],u=r.length;(e||"object"!==o(s))&&(s={});for(var a=0;a<u;++a){var f=r[a],c=o(f);if("object"===c)for(var l in f){var h=e?i.clone(f[l]):f[l];t?s[l]=n(s[l],h):s[l]=h}}return s}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var i=function(e){return r(e===!0,!1,arguments)},s="merge";i.recursive=function(e){return r(e===!0,!0,arguments)},i.clone=function(e){var t,n,r=e,s=o(e);if("array"===s)for(r=[],n=e.length,t=0;t<n;++t)r[t]=i.clone(e[t]);else if("object"===s){r={};for(t in e)r[t]=i.clone(e[t])}return r},t?e.exports=i:window[s]=i}("object"===("undefined"==typeof e?"undefined":h(e))&&e&&"object"===h(e.exports)&&e.exports)}),x={Accept:"application/json, text/plain, */*","Content-Type":"application/json"},T={xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,e),this._defaults=o(T,{headers:x}),this._config={},this.set(t)}return p(e,[{key:"mergeWithDefaults",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=o.apply(void 0,[this._defaults,this._config].concat(t));return"object"===h(r.body)&&r.headers&&"application/json"===r.headers["Content-Type"]&&(r.body=JSON.stringify(r.body)),r}},{key:"set",value:function(e){this._config=o(this._config,e)}},{key:"get",value:function(){return o(this._defaults,this._config)}}]),e}(),P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,e),this._middleware=new g,this._config=new E(i(t,["baseUrl"])),this.baseUrl(t.baseUrl||""),this._initMethodsWithBody(),this._initMethodsWithNoBody()}return p(e,[{key:"create",value:function(e){return new this.constructor(e)}},{key:"use",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.before&&this._middleware.before(e.before),e.success&&this._middleware.success(e.success),e.error&&this._middleware.error(e.error),e.after&&this._middleware.after(e.after)}},{key:"defaults",value:function(e){return"undefined"==typeof e?this._config.get():(this._config.set(i(e,["baseUrl"])),e.baseUrl&&this.baseUrl(e.baseUrl),this._config.get())}},{key:"baseUrl",value:function(e){return"undefined"==typeof e?this._baseUrl:(this._baseUrl=e,this._baseUrl)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.method||(e.method="get");var t=this._config.mergeWithDefaults(e),n=w.buildQuery(a(this._baseUrl,e.url),e.params);return this._fetch(n,t)}},{key:"_fetch",value:function(e,t){var n=this,r=!0;return this._middleware.resolveBefore(t).then(function(t){return fetch(e,t)}).then(function(e){return c(e,t.bodyType)}).then(function(e){return n._middleware.resolveSuccess(e)}).then(function(e){return r=!1,n._middleware.resolveAfter(e)}).catch(function(e){return n._middleware.resolveError(e),r?n._middleware.resolveAfter(e):Promise.reject(e)})}},{key:"_initMethodsWithNoBody",value:function(){var e=this;["get","delete","head"].forEach(function(t){e[t]=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e._config.mergeWithDefaults(r,{method:t}),i=w.buildQuery(a(e._baseUrl,n),r.params);return e._fetch(i,o)}})}},{key:"_initMethodsWithBody",value:function(){var e=this;["post","put","patch"].forEach(function(t){e[t]=function(n,r,o){var i=e._config.mergeWithDefaults(o,{body:r,method:t}),s=a(e._baseUrl,n);return e._fetch(s,i)}})}}]),e}(),O=new P;return O})}),P=function(e){try{var t="function"==typeof e?e():e;return t&&"object"===("undefined"==typeof t?"undefined":b(t))&&"function"==typeof t.then?t:Promise.resolve(t)}catch(e){return Promise.reject(e)}},O=P,A=v(function(e,t){var n=O,r=function(e){function t(e,r){w(this,t),"number"==typeof e&&(r=e,e=void 0);var o=null,i=T(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,function(t,i){o={resolve:t,reject:i,fn:e,duration:r},"number"==typeof r?o.timeoutId=_.setTimeout(function(){n(e).then(t).catch(i)},r):e(t,i)}));return i._parent=null,i._timeoutData=o,i}return x(t,e),g(t,[{key:"then",value:function(e){var n=k(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"then",this).call(this,e);return n._parent=this,n}},{key:"clear",value:function(e){var t=this._timeoutData;_.clearTimeout(t.timeoutId),t.resolve(e)}},{key:"reset",value:function(){var e=this._timeoutData;_.clearTimeout(e.timeoutId),e.timeoutId=_.setTimeout(function(){n(e.fn).then(e.resolve).catch(e.reject)},e.duration)}},{key:"_timeoutData",get:function(){return this._parent?this._parent._timeoutData:this.__timeoutData},set:function(e){this.__timeoutData=e}}]),t}(Promise),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new r(e,t)};t=e.exports=o,t.TimeoutPromise=r}),j=v(function(e,t){var n=O,r=function(e){function t(e,r){w(this,t);var o=void 0,i=void 0,s=T(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,function(t,s){o=t,"number"==typeof r?i=_.setInterval(function(){n(e).catch(function(e){clearInterval(i),s(e)})},r):e(t,s)}));return s._intervalId=i,s._resolve=o,s}return x(t,e),g(t,[{key:"then",value:function(e){var n=k(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"then",this).call(this,e);return n._intervalId=this._intervalId,n._resolve=this._resolve,n}},{key:"clear",value:function(e){clearInterval(this._intervalId),this._resolve(e)}}]),t}(Promise),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new r(e,t)};t=e.exports=o,t.IntervalPromise=r}),L=v(function(e,t){!function(t,n){e.exports=n()}(_,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==b(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":b(e)},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();if(!window)throw new Error("Missing window object.");if(!window.localStorage)throw new Error("localStorage is not supported.");if(!window.sessionStorage)throw new Error("sessionStorage is not supported.");var i=function(){function e(t){n(this,e),this.storage=t&&"session"===t.toLowerCase()?window.sessionStorage:window.localStorage}return o(e,[{key:"get",value:function(e){var t=this.storage.getItem(e);if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(e){return t||void 0}}},{key:"getAll",value:function(){var e=this;return Array.apply(0,new Array(this.storage.length)).map(function(t,n){return e.storage.key(n)})}},{key:"set",value:function(e,t){if(e)return t="object"===("undefined"==typeof t?"undefined":r(t))?JSON.stringify(t):t,this.storage.setItem(e,t),t}},{key:"remove",value:function(e){this.storage.removeItem(e)}},{key:"clear",value:function(){this.storage.clear()}}]),e}();t.default=i,e.exports=t.default}])})}),S=y(L),D=function(e){function t(){w(this,t);var e=T(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._env="DEV",e.token=null,e.tokenExpiriesAt=null,e._tokenDuration=12e5,e._storage=new S,e._inactivityCheckInterval=null,e._tokenRenewTimeout=null,e._inactivityTimeout=null,e._pageActivityDetected=!1,e._watchForPageActivity=!1,e.session={},e._restoreExistingSession(),e.isAuthenticated=null!==e.token,e._initMiddlewares(),e._initMethods(),e}return x(t,e),g(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._setUpMiddlewares(t.middlewares),t.configPath?E.get(t.configPath).then(function(t){t.data.env&&(e._env=t.data.env),t.data.tokenDuration&&(e._tokenDuration=t.data.tokenDuration);var n=function(){var e=t.data.api&&t.data.api.url;return e||"http://localhost:8080"};t.data.httpConfig||(t.data.httpConfig={}),t.data.httpConfig.baseUrl||(t.data.httpConfig.baseUrl=n()),E.defaults(t.data.httpConfig)}):(t.httpConfig||(t.httpConfig={}),t.httpConfig.baseUrl||(t.httpConfig.baseUrl="http://localhost:8080"),E.defaults(t.httpConfig),Promise.resolve())}},{key:"getEnvironment",value:function(){return this._env}},{key:"isProd",value:function(){return"PROD"===this._env}},{key:"login",value:function(e,t){var n=this;return E.post("/token",{email:e,password:t}).then(function(e){n.isAuthenticated=!0,n.token=e.data.token,n.tokenExpiriesAt=e.data.expiresAt,n._storage.set("token",e.data.token),n._storage.set("tokenExpiriesAt",e.data.expiresAt),n._watchForPageActivity&&n._startRenewTokenLoop()})}},{key:"getSession",value:function(){var e=this;return E.get("/user/current").then(function(t){return e.session=t.data,e._storage.set("session",t.data),Promise.resolve(t)})}},{key:"logout",value:function(){return this.isAuthenticated=!1,delete this.token,this._storage.remove("token"),this._storage.remove("tokenExpiriesAt"),this._stopRenewTokenLoop(),Promise.resolve()}},{key:"resetPasswordRequest",value:function(e){return E.post("/user/send-password-reset/"+e).then(function(e){return e.data})}},{key:"resetPassword",value:function(e,t){return E.post("/user/reset-password/"+t,{newPassword:e}).then(function(e){return e.data})}},{key:"watchForInactivity",value:function(){var e=this;this._watchForPageActivity||(window.addEventListener("keydown",function(){e._pageActivityDetected=!0}),window.addEventListener("mousemove",function(){e._pageActivityDetected=!0}),this._watchForPageActivity=!0)}},{key:"_restoreExistingSession",value:function(){this.token=this._storage.get("token")||null}},{key:"_startRenewTokenLoop",value:function(){var e=this,t=function(){e._tokenRenewTimeout&&(e._tokenRenewTimeout.clear(),e._tokenRenewTimeout=null);var t=new Date(e.tokenExpiriesAt).getTime()-Date.now();e._tokenRenewTimeout=A(function(){return E.put("/token").then(function(t){e.tokenExpiriesAt=t.data.expiresAt,e._storage.set("tokenExpiriesAt",t.data.expiresAt)})},t)},n=function(){e._inactivityTimeout&&(e._inactivityTimeout.clear(),e._inactivityTimeout=null),e._inactivityTimeout=A(function(){e.delete("/token").then(function(t){return e.emit("session-expired")})},e._tokenDuration)},r=function(){return e._pageActivityDetected?void(e._pageActivityDetected=!1):void n()};this._inactivityCheckInterval=j(r,500),t()}},{key:"_stopRenewTokenLoop",value:function(){this._tokenRenewTimeout&&(this._tokenRenewTimeout.clear(),this._tokenRenewTimeout=null),this._inactivityTimeout&&(this._inactivityTimeout.clear(),this._inactivityTimeout=null),this._inactivityCheckInterval&&(this._inactivityCheckInterval.clear(),this._inactivityCheckInterval=null)}},{key:"_initMethods",value:function(){var e=this;["get","post","put","delete"].forEach(function(t){e[t]=function(){return E[t].apply(E,arguments).then(function(e){return e.data})}})}},{key:"_initMiddlewares",value:function(){var e=this;E.use({before:function(t){return e.emit("before",t),e.isAuthenticated&&(t.headers.authorization=e.token),t}}),E.use({error:function(t){return e.emit("error",t),Promise.reject(t)}}),E.use({success:function(t){return e.emit("success",t),Promise.resolve(t)}}),E.use({after:function(t){return e.emit("after",t),Promise.resolve(t)}})}},{key:"_setUpMiddlewares",value:function(e){e&&(e.before&&e.before.length&&e.before.forEach(function(e){return E.use({before:e})}),e.success&&e.success.length&&e.success.forEach(function(e){return E.use({success:e})}),e.error&&e.error.length&&e.error.forEach(function(e){return E.use({error:e})}),e.after&&e.after.length&&e.after.forEach(function(e){return E.use({after:e})}))}}]),t}(t),U=new D;return U.HTTP=D,U});
